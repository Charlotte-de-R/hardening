# --- COMMON HARDENING START (DO NOT EDIT MANUALLY) ---
ARG CACHEBUST=1
RUN echo "Cache bust: $CACHEBUST" && \
    export PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:$PATH" && \
    if command -v apk >/dev/null 2>&1; then \
        echo "â›°ï¸ Alpine Linux detected" && \
        (apk update || echo "âš ï¸ apk update failed, skipping") && \
        (apk upgrade --no-cache || echo "âš ï¸ apk upgrade failed, skipping") && \
        (apk del --no-cache nano vim git || true) && \
        rm -rf /var/cache/apk/* /usr/share/man/* || true; \
    elif command -v apt-get >/dev/null 2>&1; then \
        echo "ğŸŒ€ Debian/Ubuntu detected" && \
        (apt-get update || echo "âš ï¸ apt-get update failed, skipping") && \
        (apt-get upgrade -y || echo "âš ï¸ apt-get upgrade failed, skipping") && \
        (apt-get purge -y --auto-remove vim nano git telnet ftp man-db doc-debian || true) && \
        apt-get clean && \
        rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /usr/share/doc/* /usr/share/man/* || true; \
    else \
        echo "âš ï¸ No supported package manager found. Skipping hardening steps." && \
        true; \
    fi
# --- COMMON HARDENING END ---
